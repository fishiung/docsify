# 代码开发规范

## 0 适用范围 

Java/Scala 等 JVM 语言 

## 1 通用规范

### 1.1 命名规范 

#### 1.1.1 类和接口

命名仅包含英文字符和阿拉伯数字，驼峰风格(UpperCamelCase )，以下情形例外 ：DO/BO/DTO/VO/AO/DAO、含有特殊专有名词、通用缩写

##### 1.1.1.1 抽象类

以 **Abstract**  开头

##### 1.1.1.2 工具类

以 **Utils**  结尾

##### 1.1.1.3 异常类

以 ** Exception **  结尾

##### 1.1.1.4 单元测试类

待测试的类名 + **Test**   结尾

##### 1.1.1.5 具有命名习惯的设计模式类

- 工厂/抽象工厂： 以 **Factory**  /** Provider**  结尾
- 建造者： 以 **Builder**  结尾
- 适配器： 以 **Adapter**  结尾
- 代理： 以 **Proxy**  结尾

##### 1.1.1.6 使用软件设计模式的类

- OOP
- MVC
- DDD

#### 1.1.2 包

 仅包含小写英文字符

#### 1.1.3 方法

 以下仅适用于DAO、Service、Controller层

-  获取单个对象的方法用 get 做前缀，跟单数形式结尾如：getObject
-  获取多个对象的方法用 get 做前缀，跟复数形式结尾如：getObjects
-  插入方法用 insert 做前缀
-  删除方法用 delete 做前缀
-  修改方法用 update 做前缀
-  搜索方法用 search 做前缀

#### 1.1.4 变量

- 仅包含英文字符、阿拉伯数字，驼峰风格(LowerCamelCase )，含有特殊专有名词、通用缩写除外
- 命名尽可能清晰明了，禁用单字母，歧义单词，歧义缩写，拼音
- 算法过程变量可以使用单字母
- 布尔类型变量不可使用  **is**  前缀

#### 1.1.5 常量

仅包含大写英文字符、阿拉伯数字，使用完整英文单词或者英文词组进行描述，多个单词以下划线分割，禁止使用魔法值

#### 1.1.6 范围变量

使用枚举类，枚举类目须符合常量规范

### 1.2  代码格式

#### 1.2.1 大括号

- 左大括号前不换行
- 左大括号后换行
- 右大括号前换行
- 右大括号后还有 `else`  等代码则不换行表示终止的右大括号后必须换行
- 如果大括号内没有内容，键入 `{}`， 不必换行
-  `if/else` 的大括号不可忽略

#### 1.2.2 单行代码限制

代码单行字符数限制不超过 120 个，超出需要换行，换行时遵循如下原则：

- 运算符与下文一起换行
- 方法调用的点符号与下文一起换行
- 方法调用时，多个参数，需要换行时，在逗号后进行
- 在括号前不换行

#### 1.2.3 方法行数限制

单个方法不得超过80行，行数计算从方法声明至方法结束大括号

#### 1.2.4 类行数限制

单个类不得超过2000行，行数计算从类声明至类结束大括号

#### 1.2.4 注释

- 类、类属性、类方法注释，使用 Javadoc 文档注释 `/** 内容 */` 
- 抽象方法（包括接口中的方法）需描述返回值、参数、异常说明，方法作用，对子类的实现要求，或者调用注意事项
- 类、类属性、类方法的注释必须含有 
	- `@since`何时引入
	- `@author` 作者
	- `@Version` 类的版本，
- 当修改部分与原先方法使用方式或者逻辑不同时，需添加说明并修正注释
- 方法内部使用单行注释时，在被注释语句上方另起一行，使用 `// 内容` 
- 方法内部使用多行注释时，在被注释语句上方另起一行，使用 `/* 内容 */` 
- 使用中文注释，仅专有名词与关键字保持英文原文
- `//TODO`  （大写）须有标记人，标记时间，预处理时间，具体事项
- `//FIXME` （大写）须有标记人，标记时间，预处理时间，问题说明

### 1.3 编程规范

#### 1.3.1 接口

 接口中不得出现 public 、static、final 关键字

#### 1.3.2 类

- 继承权限的字段和方法务必使用 protected 关键字修饰
- 原则上禁用过时类

#### 1.3.3 方法

- 重写方法必须添加 `@Overrid`  注解
- 方法过时须加@Deprecated 注解，并说明替代方法
- 原则上禁用过时方法

#### 1.3.4 try-catch

-  `java.lang.AutoCloseable` 的实现类使用try-with-resources 关闭
	```java
	try(FileReader reader = new FileReader("test.txt"){
	  /*
		业务逻辑
	  */
	} catch (FileNotFoundException e) {
		//业务逻辑
	} 
	```
-  忽略异常的格式如下
	```java
	try{
	  /*
		业务逻辑
	  */
	} catch (Exception ignore) {} 
	```

#### 1.3.5 switch (Java)

- case 语句后换行
- case 中的代码逻辑超过一行代码时，用大括号括起
- break 语句不可省略
- default 语句不可省略
	```java
	switch(expr){
		case someCase:
			// 一行逻辑
			break;
		case someCase:
			{
				/*
				  复杂逻辑
				*/
			}
			break;
		default:
			//nothing
			break;
	}
	```

#### 1.3.6 pojo

- 成员变量禁用原生类型，使用相应的包装类型
- 成员变量私有，生成其对应的getter/setter 方法
- 重写 equals()、hashCode()、toString() 方法

#### 1.3.7 异常

- 优先使用标准异常 （JDK自带）
- 非特殊或者确定的逻辑外，不可以丢失异常信息，且捕获异常必须处理异常
	```java
	 try {
	     // ...
	 } catch (Exception e) {
	    //a. throw new SomeException(); 丢失异常
		//b. log.error("some message"); 丢失异常
	 }
	```
- 对界面操作用户可见的异常信息使用中文描述

#### 1.3.8 循环

- 不得在循环中重复创建公用对象
- 重复使用的临时变量在循环外进行声明
- 循环体中若存在公共操作，应重构至循环外
- 循环体中尽量避免使用 try-catch

## 2 接口规范

### 2.1 符合RESTful规范

- 使用HTTP(S)协议
- 正常情况下数据返回格式为JSON
- 在URL 中添加 api 
	```html
	http(s)://example.org/api/
	```
- 在URL中添加版本号
	```html
	 http(s)://example.com/api/v1/
	```
- URL路径由资源名称组成
- 使用标准HTTP方法(GET、PUT、POST、DELETE)，并遵循这些方法的语义

### 2.2 资源命名

- 不包括资源的操作
	```html
	错误示例：
	GET /getUser/1    			-- 获取id=1的用户
	POST /createUser			-- 创建用户
	PUT /updateUser/1			-- 更新id=1的用户 
	DELETE /deleteUser/1		-- 删除id=1的用户

	正确示例：
	GET /users/1
	POST /users
	PUT /users/1
	DELETE /users/1
	```
- 资源使用复数形式
	```html
	GET /zoo      --列出所有动物园  错误
	GET /zoos     --正确
	```
- 使用资源定位资源
	```html
	GET /zoos/animals/{zooId}  --列出某个动物园的所有动物 错误
	GET /zoos/{zooId}/animals  --正确
	```
- 当资源为多个英文单词组成时遵守驼峰风格(LowerCamelCase )
	```html
	GET /testplans  --获取测试计划列表  错误
	GET /testPlans  --正确
	```

### 2.3 方法说明

- GET：从服务器取出资源（一项或多项）/简单的查询请求
- POST：在服务器新建一个资源 / 复杂的查询请求
- PUT：在服务器更新资源（客户端提供改变后的完整资源）
- DELETE：从服务器删除资源

### 2.4 返回格式

```json
{
	"message": "some message", //消息
	"data": {}, //返回的数据，也可以是一个数组[]
	"statusCode": 200 //状态码
}
```

### 2.5 状态码

- 200 OK ：`[GET][POST]` 服务器成功返回用户请求的数据，幂等操作
- 201 Created ：`[POST][PUT]` 用户新建或修改数据成功
- 202 Accepted ：`[*]` 请求已进入后台排队或消息队列（异步任务）
- 204 No Content ：`[DELETE]` 用户删除数据成功。
- 400 Bad Request ：`[*]` 用户请求语法错误，服务器无法解析，幂等操作
- 401 Unauthorized ：`[*]` 表示用户没有权限（令牌、用户名、密码错误）
- 403 Forbidden  ：`[*]`  用户得到授权（与401相对），但访问是被禁止的
- 404 Not Found ：`[*]` 用户请求的资源不存在，服务器没有进行操作，幂等操作
- 500 Internal Server Error ：`[*]` 服务器内部错误，无法完成请求

### 2.6 自定义键值对命名

 键：遵守驼峰风格(LowerCamelCase )
